# { true }
{ true }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))))

# { !true }
{ !true }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static))))))

# { true && false }
{ true && false }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static), And, FieldExpression(Static))))))

# { true || false }
{ true || false }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static), Or, FieldExpression(Static))))))

# { 1 = 2 }
{ 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 != 2 }
{ 1 != 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 > 2 }
{ 1 > 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 >= 2 }
{ 1 >= 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 < 2 }
{ 1 < 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 <= 2 }
{ 1 <= 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer)))))))

# { -1 = 2 }
{ -1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer))))))))

# { "test" =~ "test" }
{ "test" =~ "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(String)), FieldOp, FieldExpression(Static(String)))))))

# { "test" !~ "test" }
{ "test" !~ "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(String)), FieldOp, FieldExpression(Static(String)))))))

# { "test" = "test" }
{ "test" = "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(String)), FieldOp, FieldExpression(Static(String)))))))

# { "test" != "test" }
{ "test" != "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(String)), FieldOp, FieldExpression(Static(String)))))))

# { .a }
{ .a }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(AttributeField(Identifier))))))

# { !.a }
{ !.a }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)))))))

# { .a && false }
{ .a && false }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), And, FieldExpression(Static))))))

# { .a || true }
{ .a || true }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), Or, FieldExpression(Static))))))

# { .a = 2 }
{ .a = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { .a != 2 }
{ .a != 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { .a > 2 }
{ .a > 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { .a >= 2 }
{ .a >= 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { .a < 2 }
{ .a < 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { .a <= 2 }
{ .a <= 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { -.a = 2 }
{ -.a = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer))))))))

# { .a =~ "test" }
{ .a =~ "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(String)))))))

# { .a !~ "test" }
{ .a !~ "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(String)))))))

# { .a = "test" }
{ .a = "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(String)))))))

# { .a != "test" }
{ .a != "test" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(String)))))))

# { resource.a != 3 }
{ resource.a != 3 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Resource, Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { span.a != 3 }
{ span.a != 3 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Span, Identifier)), FieldOp, FieldExpression(Static(Integer)))))))

# { !("test" != .c || ((true && .b) || 3 < .a)) }
{ !("test" != .c || ((true && .b) || 3 < .a)) }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(FieldExpression(Static(String)), FieldOp, FieldExpression(FieldExpression(AttributeField(Identifier)), Or, FieldExpression(FieldExpression(FieldExpression(FieldExpression(FieldExpression(FieldExpression(Static), And, FieldExpression(AttributeField(Identifier)))), Or, FieldExpression(Static(Integer))), FieldOp, FieldExpression(AttributeField(Identifier))))))))))))

# { status = ok }
{ status = ok }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { status = unset }
{ status = unset }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { status = error }
{ status = error }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { status != error }
{ status != error }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { kind = internal }
{ kind = internal }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { kind = client }
{ kind = client }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { kind = consumer }
{ kind = consumer }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static))))))

# { traceDuration > 1s }
{ traceDuration > 1s }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static(Duration)))))))

# { rootServiceName = "foo" }
{ rootServiceName = "foo" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static(String)))))))

# { rootName != "foo" }
{ rootName != "foo" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static(String)))))))

# { duration > 1s }
{ duration > 1s }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static(Duration)))))))

# { 1 < 1h }
{ 1 < 1h }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Duration)))))))

# { 1 <= 1.1 }
{ 1 <= 1.1 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Float)))))))

# { 1 + 1 = 2 }
{ 1 + 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 - 1 = 2 }
{ 1 - 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 * 1 = 2 }
{ 1 * 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 / 1 = 2 }
{ 1 / 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 ^ 1 = 2 }
{ 1 ^ 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { .a + 1 = 2 }
{ .a + 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { .a - 1 = 2 }
{ .a - 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { .a * 1 = 2 }
{ .a * 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { .a / 1 = 2 }
{ .a / 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { .a ^ 1 = 2 }
{ .a ^ 1 = 2 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(Integer))), FieldOp, FieldExpression(Static(Integer)))))))

# { duration > 1s * 2s }
{ duration > 1s * 2s }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(Static(Duration))), FieldOp, FieldExpression(Static(Duration)))))))

# { 1 * 1h = 1 }
{ 1 * 1h = 1 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Duration))), FieldOp, FieldExpression(Static(Integer)))))))

# { 1 / 1.1 = 1 }
{ 1 / 1.1 = 1 }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(Static(Float))), FieldOp, FieldExpression(Static(Integer)))))))

# { .http.status >= "200" }
{ .http.status >= "200" }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(AttributeField(Identifier)), FieldOp, FieldExpression(Static(String)))))))

# { true } && { true }
{ true } && { true }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetExpression(SpansetFilter(FieldExpression(Static))), And, SpansetExpression(SpansetFilter(FieldExpression(Static))))))

# { true } || { true }
{ true } || { true }
==>
TraceQL(SpansetPipeline(SpansetExpression(SpansetExpression(SpansetFilter(FieldExpression(Static))), Or, SpansetExpression(SpansetFilter(FieldExpression(Static))))))

# avg(.field) > 1
avg(.field) > 1
==>
TraceQL(SpansetPipeline(ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(AttributeField(Identifier)))), ComparisonOp, ScalarExpression(Integer))))

# max(duration) >= 1s
max(duration) >= 1s
==>
TraceQL(SpansetPipeline(ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))))

# max(duration) > 1
max(duration) > 1
==>
TraceQL(SpansetPipeline(ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Integer))))

# { true } | max(duration) = 1h
{ true } | max(duration) = 1h
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))))

# { true } | min(duration) = 1h
{ true } | min(duration) = 1h
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))))

# { true } | sum(duration) = 1h
{ true } | sum(duration) = 1h
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))))

# { true } | max(.a) = 1
{ true } | max(.a) = 1
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(AttributeField(Identifier)))), ComparisonOp, ScalarExpression(Integer))))

# { true } | max(span.a) = 1
{ true } | max(span.a) = 1
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(AttributeField(Span, Identifier)))), ComparisonOp, ScalarExpression(Integer))))

# { true } | max(resource.a) = 1
{ true } | max(resource.a) = 1
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(AttributeField(Resource, Identifier)))), ComparisonOp, ScalarExpression(Integer))))

# { true } | max(1 + .a) = 1
{ true } | max(1 + .a) = 1
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(AttributeField(Identifier))))), ComparisonOp, ScalarExpression(Integer))))

# { true } | max((1 + .a) * 2) = 1
{ true } | max((1 + .a) * 2) = 1
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(AttributeField(Identifier)))), FieldOp, FieldExpression(Static(Integer))))), ComparisonOp, ScalarExpression(Integer))))

# max(duration) > 3s | { status = error || .http.status = 500 }
max(duration) > 3s | { status = error || .http.status = 500 }
==>
TraceQL(SpansetPipeline(SpansetPipeline(ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(FieldExpression(FieldExpression(IntrinsicField), FieldOp, FieldExpression(FieldExpression(Static), Or, FieldExpression(AttributeField(Identifier)))), FieldOp, FieldExpression(Static(Integer)))))))

# select(.a)
select(.a)
==>
TraceQL(SpansetPipeline(SelectOperation(SelectArgs(FieldExpression(AttributeField(Identifier))))))

# {} | select(.a,.b,.c)
{} | select(.a,.b,.c)
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter)), Pipe, SelectOperation(SelectArgs(SelectArgs(SelectArgs(FieldExpression(AttributeField(Identifier))), FieldExpression(AttributeField(Identifier))), FieldExpression(AttributeField(Identifier))))))

# { true } | { .a }
{ true } | { .a }
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(AttributeField(Identifier))))))

# { true } | count() = 1
{ true } | count() = 1
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))))

# { true } | avg(duration) = 1h
{ true } | avg(duration) = 1h
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))))

# count() = 1 | { true }
count() = 1 | { true }
==>
TraceQL(SpansetPipeline(SpansetPipeline(ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static)))))

# { true } | count() = 1 | { true }
{ true } | count() = 1 | { true }
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static)))))

# ({ true } | count() > 1 | { false }) && ({ true } | count() > 1 | { false })
({ true } | count() > 1 | { false }) && ({ true } | count() > 1 | { false })
==>
TraceQL(SpansetPipelineExpression(SpansetPipelineExpression(WrappedSpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static)))))), And, SpansetPipelineExpression(WrappedSpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static))))))))

# ({ true } | count() > 1 | { false }) || ({ true } | count() > 1 | { false })
({ true } | count() > 1 | { false }) || ({ true } | count() > 1 | { false })
==>
TraceQL(SpansetPipelineExpression(SpansetPipelineExpression(WrappedSpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static)))))), Or, SpansetPipelineExpression(WrappedSpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static))))))))

# { true } | coalesce()
{ true } | coalesce()
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, CoalesceOperation))

# { true } | by(1 + .a) | coalesce()
{ true } | by(1 + .a) | coalesce()
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, GroupOperation(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(AttributeField(Identifier))))), Pipe, CoalesceOperation))

# { true } | by(.a)
{ true } | by(.a)
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, GroupOperation(FieldExpression(AttributeField(Identifier)))))

# { true } | by(1 + .a)
{ true } | by(1 + .a)
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, GroupOperation(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(AttributeField(Identifier))))))

# by(.a) | { true }
by(.a) | { true }
==>
TraceQL(SpansetPipeline(SpansetPipeline(GroupOperation(FieldExpression(AttributeField(Identifier)))), Pipe, SpansetExpression(SpansetFilter(FieldExpression(Static)))))

# { true } | by(name) | count() > 2
{ true } | by(name) | count() > 2
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, GroupOperation(FieldExpression(IntrinsicField))), Pipe, ScalarFilter(ScalarExpression(Aggregate), ComparisonOp, ScalarExpression(Integer))))

# { true } | by(.field) | avg(.b) = 2
{ true } | by(.field) | avg(.b) = 2
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, GroupOperation(FieldExpression(AttributeField(Identifier)))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(AttributeField(Identifier)))), ComparisonOp, ScalarExpression(Integer))))

# { true } | by(3 * .field - 2) | max(duration) < 1s
{ true } | by(3 * .field - 2) | max(duration) < 1s
==>
TraceQL(SpansetPipeline(SpansetPipeline(SpansetPipeline(SpansetExpression(SpansetFilter(FieldExpression(Static)))), Pipe, GroupOperation(FieldExpression(FieldExpression(FieldExpression(Static(Integer)), FieldOp, FieldExpression(AttributeField(Identifier))), FieldOp, FieldExpression(Static(Integer))))), Pipe, ScalarFilter(ScalarExpression(Aggregate(AggregateExpression, FieldExpression(IntrinsicField))), ComparisonOp, ScalarExpression(Duration))))

